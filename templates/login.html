<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - WatchGuard</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body class="bg-gradient login-page">
    <div class="container">
      <div
        class="login-container"
        style="
          min-height: 100dvh;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <div class="glass-card login-card">
          <div class="login-header">
            <h1>
              <span class="watch-text">Watch</span
              ><span class="guard-text">Guard</span>
            </h1>
          </div>

          <form id="loginForm" class="login-form">
            <div id="errorMessage" class="error-message hidden"></div>

            <div class="form-group">
              <input
                type="text"
                id="username"
                name="username"
                class="form-input"
                placeholder="Username"
                required
              />
            </div>

            <div class="form-group password-field">
              <input
                type="password"
                id="password"
                name="password"
                class="form-input"
                placeholder="Password"
                required
              />
              <button
                type="button"
                class="password-toggle"
                id="passwordToggle"
                aria-label="Toggle password visibility"
              >
                <svg
                  class="eye-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  ></path>
                </svg>
                <svg
                  class="eye-slash-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                  style="display: none"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"
                  ></path>
                </svg>
              </button>
            </div>

            <input type="hidden" id="csrf_token" name="csrf_token" value="" />
            <div class="form-actions">
              <button type="submit" class="glass-button primary login-btn">
                Login
              </button>
            </div>
          </form>

          <div class="login-card-footer">
            <span>WatchGuard • {{ APP_VERSION }}</span>
            <br />
            <span style="opacity: 0.85">Made with ❤️ by AsanFillter</span>
          </div>
        </div>
      </div>
    </div>

    <div id="notification" class="notification hidden"></div>

    <script>
      const passwordToggle = document.getElementById("passwordToggle");
      const passwordInput = document.getElementById("password");
      const eyeIcon = document.querySelector(".eye-icon");
      const eyeSlashIcon = document.querySelector(".eye-slash-icon");

      passwordToggle.addEventListener("click", function () {
        const type =
          passwordInput.getAttribute("type") === "password"
            ? "text"
            : "password";
        passwordInput.setAttribute("type", type);

        if (type === "text") {
          eyeIcon.style.display = "none";
          eyeSlashIcon.style.display = "block";
          passwordToggle.classList.add("show");
        } else {
          eyeIcon.style.display = "block";
          eyeSlashIcon.style.display = "none";
          passwordToggle.classList.remove("show");
        }
      });

      function getCookie(name) {
        const match = document.cookie.match(
          new RegExp("(^| )" + name + "=([^;]+)")
        );
        return match ? decodeURIComponent(match[2]) : "";
      }
      document.addEventListener("DOMContentLoaded", function () {
        const token = getCookie("csrf_token");
        const input = document.getElementById("csrf_token");
        if (input) input.value = token || "";
      });

      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const submitBtn = this.querySelector('button[type="submit"]');
          const originalText = submitBtn.innerHTML;
          const errorMessage = document.getElementById("errorMessage");

          errorMessage.classList.add("hidden");

          submitBtn.innerHTML = "Logging in...";
          submitBtn.disabled = true;

          try {
            const response = await fetch("/login", {
              method: "POST",
              body: formData,
            });

            const result = await response.json();

            if (result.status === "success") {
              showNotification("Login successful! Redirecting...", "success");
              setTimeout(() => {
                window.location.href = "/";
              }, 1000);
            } else {
              showErrorMessage(
                result.message || "Username or password is incorrect"
              );
              submitBtn.innerHTML = originalText;
              submitBtn.disabled = false;
            }
          } catch (error) {
            showErrorMessage("Network error! Please try again.");
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          }
        });

      function showErrorMessage(message) {
        const errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = message;
        errorMessage.classList.remove("hidden");

        setTimeout(() => {
          errorMessage.classList.add("hidden");
        }, 5000);
      }

      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.remove("hidden");
        setTimeout(() => {
          notification.classList.add("hidden");
        }, 3000);
      }
    </script>
  </body>
</html>
